function delay_till_last(e,t,n){return _timer[e]&&(window.clearTimeout(_timer[e]),delete _timer[e]),_timer[e]=window.setTimeout(function(){t(),delete _timer[e]},n)}function ajax_load_hide(){$("#ajax_load").hide()}function ajax_load_show(){$("#ajax_load").show()}function mask_hide(){$("#main .mask").hide()}function mask_show(){$("#main .mask").show()}function Bing_pic(){$("img.pic").each(function(){var e=$(this).attr("data-src");$(this).attr("src",e)})}var _timer={};$(document).ready(function(){Bing_pic(),$("#footmenu li").on("click",function(){$("#footmenu li").removeClass("current"),$(this).addClass("current")}),setInterval("Bing_pic()",100),$(".nextpage a").attr("href",$(".nextpage a").attr("href")+"?action=ajax_list");var e=null;$(window).scroll(function(){delay_till_last("scroll_Ajax",function(){$(window).scrollTop()>=$(document).height()-$(window).height()-80&&(ajax_load_show(),e=$(".nextpage a").attr("href"),e?$.ajax({type:"GET",url:e,success:function(e){Bing_pic(),ajax_load_hide(),$(".nextpage").remove(),$(".postlist").append(e),Bing_pic()},error:function(e){Bing_pic(),ajax_load_hide(),$(".postlist").after('<div id="ajax-list-error">文章获取失败</div>'),Bing_pic()}}):(ajax_load_hide(),$("#ajax-list-error").remove(),$(".postlist").after('<div id="ajax-list-error">全部文章已加载完毕，没有更多的文章了~</div>')))},100)}),$("a.logo").on("click",function(){$("#footmenu li").removeClass("current"),$("#footmenu li.home").addClass("current")}),$("#ajax_load").hide()}),jQuery(document).keypress(function(e){e.ctrlKey&&e.which==13||e.which==10?(jQuery(".submit").click(),document.body.focus()):(e.shiftKey&&e.which==13||e.which==10)&&jQuery(".submit").click()}),jQuery(document).ready(function(e){var t=null,n=!1,r=document.title,i,s=window.opera?document.compatMode=="CSS1Compat"?e("html"):e("body"):e("html,body");if(window.history&&window.history.pushState){var o=" a[target!=_blank]:not([href*='#'])";e(document).on("click","a.logo,#footmenu"+o+",.postlist"+o+",.categorypage"+o,function(o){o.preventDefault(),t==null?i={url:document.location.href,title:document.title,html:e("#main").html(),top:s.scrollTop()}:t.abort(),i.top=s.scrollTop();var u=e(this).attr("href").replace("?action=ajax_load","");return $("html, body").animate({scrollTop:0},120),ajax_load_show(),$("#main").fadeTo(500,.3),e("#main").hide,t=e.ajax({url:u+"?action=ajax_load",success:function(t){n=!0;var i={url:u,title:r,html:t};history.pushState(i,r,u),document.title=r,Bing_pic(),$("#main").fadeTo(200,1),ajax_load_hide(),e("#main").html(t),$("#header-area .title").html(HeaderTitle),$("title").html(PageTitle),Bing_ajax_comm()}}),!1}),window.addEventListener("popstate",function(r){if(t==null)return;r&&r.state?(n=!0,document.title=r.state.title,e("#main").html(r.state.html)):(n=!1,document.title=i.title,e("#main").html(i.html),s.animate({scrollTop:i.top},0))})}})